{"remainingRequest":"/Users/wuchao/Documents/share/testOne/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wuchao/Documents/share/testOne/src/views/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wuchao/Documents/share/testOne/src/views/Login.vue","mtime":1559792279203},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n    name: \"Login\",\n    data() {\n        return {\n            isLoginError: false,\n            longitude: 0,\n            latitude: 0,\n            code: '',\n            phone: '',\n            user: {},\n            src: require('../assets/login-submit.png')\n        }\n    },\n    methods: {\n        showToast(msg, duration) {\n            duration = isNaN(duration) ? 3000 : duration;\n            var m = document.createElement('div');\n            m.innerHTML = msg;\n            m.style.cssText = \"width:60%; min-width:180px; background:#000; opacity:0.6; height:auto;min-height: 30px; color:#fff; line-height:30px; text-align:center; border-radius:4px; position:fixed; top:60%; left:20%; z-index:999999;\";\n            document.body.appendChild(m);\n            setTimeout(function () {\n                var d = 0.5;\n                m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';\n                m.style.opacity = '0';\n                setTimeout(function () {\n                    document.body.removeChild(m)\n                }, d * 1000);\n            }, duration);\n        },\n        getLocation() {\n            let _thit = this\n            var map = new BMap.Map(\"allmap\");\n            var point = new BMap.Point(116.331398, 39.897445);\n            map.centerAndZoom(point, 12);\n\n            var geolocation = new BMap.Geolocation();\n            geolocation.getCurrentPosition(function (r) {\n                if (this.getStatus() == BMAP_STATUS_SUCCESS) {\n                    var mk = new BMap.Marker(r.point);\n                    map.addOverlay(mk);\n                    map.panTo(r.point);\n                    _thit.longitude = r.point.lng\n                    _thit.latitude = r.point.lat\n                    // if (r.accuracy == null) {\n                    //     WeixinJSBridge.call('closeWindow');\n                    //     _thit.showToast('您没有开启权限！')\n                    //     var opened = window.open('about:blank', '_self');\n                    //     opened.opener = null;\n                    //     opened.close();\n                    //     return;\n                    //     //用户决绝地理位置授权\n                    // }\n                    // debugger\n                    // this.address = result.formattedAddress\n                    // alert('您的位置：' + JSON.stringify(r.address) + r.point.lng+','+r.point.lat);\n                } else {\n                    var opened = window.open('about:blank', '_self');\n                    opened.opener = null;\n                    opened.close();\n                    WeixinJSBridge.call('closeWindow');\n                    // alert('failed'+this.getStatus());\n                }\n            }, {enableHighAccuracy: true})\n        },\n        loginBack() {\n            this.src = require('../assets/login-submit.png')\n            this.isLoginError = false\n        },\n        loginError() {\n            this.src = require('../assets/login-back.png')\n            this.isLoginError = true\n        },\n        doLogin() {\n            this.$bmob.initialize('5341f8e254942033b3dae717daa7eed5', '4e0664824ca488cccad8fe1508a2baa0');\n            if (this.longitude) {\n                if (!this.isLoginError) {\n                    this.$bmob.User.login(this.code, this.phone).then(res => {\n                        this.user = res\n                        console.log('user>>>>>' + this.user)\n                        this.checkHasQuestions(res.objectId)\n                    }).catch(err => {\n                        this.loginError()\n                        console.log(err)\n                    });\n                } else {\n                    this.loginBack()\n                }\n            } else {\n                WeixinJSBridge.call('closeWindow');\n                this.showToast('您没有开启权限！')\n                var opened = window.open('about:blank', '_self');\n                opened.opener = null;\n                opened.close();\n            }\n\n\n        },\n        checkHasQuestions(objectId) {\n            const pointer = this.$bmob.Pointer('_User');\n            const poiID = pointer.set(objectId);\n            const query = this.$bmob.Query(\"question\");\n            query.equalTo(\"user\", \"==\", poiID);\n            query.count().then(res => {\n                if (res === 0) {\n                    this.loginSuccess()\n                } else {\n                    this.showToast('你已经答过题了！')\n                }\n            });\n        },\n        loginSuccess() {\n            localStorage.setItem(\"userId\", this.user.objectId)\n            localStorage.setItem(\"longitude\", this.longitude)\n            localStorage.setItem(\"latitude\", this.latitude)\n            console.log('qqq>>>>>' + this.user.objectId)\n            // this.$router.push({name: 'rule'});\n            this.$router.replace({name: 'empty'});\n        },\n        checkWx() {\n            var useragent = navigator.userAgent;\n            if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {\n                // 这里警告框会阻塞当前页面继续加载\n                alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');\n                // 以下代码是用javascript强行关闭当前页面\n                var opened = window.open('about:blank', '_self');\n                opened.opener = null;\n                opened.close();\n            }\n        }\n    },\n    created() {\n        this.checkWx()\n        this.getLocation()\n    }\n}\n",{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n    <div class=\"all-login\">\n        <div class=\"all-login-info\">\n            <img class=\"login-bg\" src=\"../assets/login-bg.png\"/>\n            <div class=\"login-info\" v-if=\"!isLoginError\">\n                <div class=\"login-name\">\n                    <img src=\"../assets/people.png\"/>\n                    <input type=\"text\" placeholder=\"门店编号\" v-model=\"code\"/>\n                </div>\n                <div class=\"login-name\">\n                    <img src=\"../assets/phone.png\"/>\n                    <input type=\"text\" placeholder=\"手机号\" v-model=\"phone\"/>\n                </div>\n            </div>\n\n            <div class=\"login-error\" v-if=\"isLoginError\">\n                <div class=\"error-title\">\n                    <img src=\"../assets/login-error.png\"/> 无法登陆\n                </div>\n                <div class=\"error-info\">1.您未入围</div>\n                <div class=\"error-info\">2.门店编号或手机号输入有误</div>\n            </div>\n\n            <img class=\"login-submit\" :src=src @click=\"doLogin\"/>\n        </div>\n\n        <div class=\"login-bottom\">请务必在您的门店内答题，我将全程对您实时定位</div>\n\n    </div>\n</template>\n\n<script>\n    export default {\n        name: \"Login\",\n        data() {\n            return {\n                isLoginError: false,\n                longitude: 0,\n                latitude: 0,\n                code: '',\n                phone: '',\n                user: {},\n                src: require('../assets/login-submit.png')\n            }\n        },\n        methods: {\n            showToast(msg, duration) {\n                duration = isNaN(duration) ? 3000 : duration;\n                var m = document.createElement('div');\n                m.innerHTML = msg;\n                m.style.cssText = \"width:60%; min-width:180px; background:#000; opacity:0.6; height:auto;min-height: 30px; color:#fff; line-height:30px; text-align:center; border-radius:4px; position:fixed; top:60%; left:20%; z-index:999999;\";\n                document.body.appendChild(m);\n                setTimeout(function () {\n                    var d = 0.5;\n                    m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';\n                    m.style.opacity = '0';\n                    setTimeout(function () {\n                        document.body.removeChild(m)\n                    }, d * 1000);\n                }, duration);\n            },\n            getLocation() {\n                let _thit = this\n                var map = new BMap.Map(\"allmap\");\n                var point = new BMap.Point(116.331398, 39.897445);\n                map.centerAndZoom(point, 12);\n\n                var geolocation = new BMap.Geolocation();\n                geolocation.getCurrentPosition(function (r) {\n                    if (this.getStatus() == BMAP_STATUS_SUCCESS) {\n                        var mk = new BMap.Marker(r.point);\n                        map.addOverlay(mk);\n                        map.panTo(r.point);\n                        _thit.longitude = r.point.lng\n                        _thit.latitude = r.point.lat\n                        // if (r.accuracy == null) {\n                        //     WeixinJSBridge.call('closeWindow');\n                        //     _thit.showToast('您没有开启权限！')\n                        //     var opened = window.open('about:blank', '_self');\n                        //     opened.opener = null;\n                        //     opened.close();\n                        //     return;\n                        //     //用户决绝地理位置授权\n                        // }\n                        // debugger\n                        // this.address = result.formattedAddress\n                        // alert('您的位置：' + JSON.stringify(r.address) + r.point.lng+','+r.point.lat);\n                    } else {\n                        var opened = window.open('about:blank', '_self');\n                        opened.opener = null;\n                        opened.close();\n                        WeixinJSBridge.call('closeWindow');\n                        // alert('failed'+this.getStatus());\n                    }\n                }, {enableHighAccuracy: true})\n            },\n            loginBack() {\n                this.src = require('../assets/login-submit.png')\n                this.isLoginError = false\n            },\n            loginError() {\n                this.src = require('../assets/login-back.png')\n                this.isLoginError = true\n            },\n            doLogin() {\n                this.$bmob.initialize('5341f8e254942033b3dae717daa7eed5', '4e0664824ca488cccad8fe1508a2baa0');\n                if (this.longitude) {\n                    if (!this.isLoginError) {\n                        this.$bmob.User.login(this.code, this.phone).then(res => {\n                            this.user = res\n                            console.log('user>>>>>' + this.user)\n                            this.checkHasQuestions(res.objectId)\n                        }).catch(err => {\n                            this.loginError()\n                            console.log(err)\n                        });\n                    } else {\n                        this.loginBack()\n                    }\n                } else {\n                    WeixinJSBridge.call('closeWindow');\n                    this.showToast('您没有开启权限！')\n                    var opened = window.open('about:blank', '_self');\n                    opened.opener = null;\n                    opened.close();\n                }\n\n\n            },\n            checkHasQuestions(objectId) {\n                const pointer = this.$bmob.Pointer('_User');\n                const poiID = pointer.set(objectId);\n                const query = this.$bmob.Query(\"question\");\n                query.equalTo(\"user\", \"==\", poiID);\n                query.count().then(res => {\n                    if (res === 0) {\n                        this.loginSuccess()\n                    } else {\n                        this.showToast('你已经答过题了！')\n                    }\n                });\n            },\n            loginSuccess() {\n                localStorage.setItem(\"userId\", this.user.objectId)\n                localStorage.setItem(\"longitude\", this.longitude)\n                localStorage.setItem(\"latitude\", this.latitude)\n                console.log('qqq>>>>>' + this.user.objectId)\n                // this.$router.push({name: 'rule'});\n                this.$router.replace({name: 'empty'});\n            },\n            checkWx() {\n                var useragent = navigator.userAgent;\n                if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {\n                    // 这里警告框会阻塞当前页面继续加载\n                    alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');\n                    // 以下代码是用javascript强行关闭当前页面\n                    var opened = window.open('about:blank', '_self');\n                    opened.opener = null;\n                    opened.close();\n                }\n            }\n        },\n        created() {\n            this.checkWx()\n            this.getLocation()\n        }\n    }\n</script>\n\n<style lang=\"stylus\" scoped>\n    .all-login\n        width 100%\n        height 100%\n        padding 0 48px\n        background: linear-gradient(to bottom, #ffffff, #e6ddf1, #e6ddf1, #e6ddf1, #3b6e9e);\n        display flex\n        flex-direction column\n        .all-login-info\n            flex 1\n            .login-submit\n                width 135px\n                height 135px\n                margin auto\n                margin-top -65px\n                text-align center\n            .login-bg\n                width 650px\n                margin-top 75px\n            .login-info\n                background #f5f3fb\n                border-radius 30px\n                padding 30px 30px\n                width 100%\n                height 460px\n                display flex\n                flex-direction column\n                .login-name\n                    width 100%\n                    height 100px\n                    background #fff\n                    border-radius 30px\n                    text-align left\n                    display flex\n                    margin-top 50px\n                    img\n                        text-align left\n                        margin-left 30px\n                        width 65px\n                        height 75px\n                        margin-top 12px\n                    input\n                        margin-left 100px\n                        width 350px\n                        outline none\n                        font-size 50px\n                        color #3b6e9e\n                        background white\n                        border none\n            .login-error\n                background #f5f3fb\n                border-radius 30px\n                padding 30px 30px\n                margin-top 60px\n                width 100%\n                height 360px\n                text-align left\n                .error-title\n                    font-size 70px\n                    display flex\n                    margin-left 80px\n                    margin-top 30px\n                    img\n                        width 100px\n                        height 100px\n                        margin-right 20px\n                .error-info\n                    margin-left 80px\n                    font-size 40px\n        .login-bottom\n            width 100%\n            font-size 20px\n            color white\n            padding-bottom 40px\n            text-align center\n</style>"]}]}