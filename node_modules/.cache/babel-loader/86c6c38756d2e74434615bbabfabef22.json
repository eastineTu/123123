{"remainingRequest":"/Users/wuchao/Documents/share/testOne/node_modules/babel-loader/lib/index.js!/Users/wuchao/Documents/share/testOne/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/wuchao/Documents/share/testOne/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wuchao/Documents/share/testOne/src/views/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wuchao/Documents/share/testOne/src/views/Login.vue","mtime":1560428840965},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/cache-loader/dist/cjs.js","mtime":1560428837382},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/babel-loader/lib/index.js","mtime":1560428837261},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/cache-loader/dist/cjs.js","mtime":1560428837382},{"path":"/Users/wuchao/Documents/share/testOne/node_modules/vue-loader/lib/index.js","mtime":1560428840712}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.regexp.replace\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: \"Login\",\n  data: function data() {\n    return {\n      isLoginError: false,\n      longitude: 0,\n      latitude: 0,\n      code: '',\n      phone: '',\n      user: {},\n      src: require(\"../assets/login-submit.png\")\n    };\n  },\n  methods: {\n    showToast: function showToast(msg, duration) {\n      duration = isNaN(duration) ? 3000 : duration;\n      var m = document.createElement('div');\n      m.innerHTML = msg;\n      m.style.cssText = \"width:60%; min-width:180px; background:#000; opacity:0.6; height:auto;min-height: 30px; color:#fff; line-height:30px; text-align:center; border-radius:4px; position:fixed; top:60%; left:20%; z-index:999999;\";\n      document.body.appendChild(m);\n      setTimeout(function () {\n        var d = 0.5;\n        m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';\n        m.style.opacity = '0';\n        setTimeout(function () {\n          document.body.removeChild(m);\n        }, d * 1000);\n      }, duration);\n    },\n    getLocation: function getLocation() {\n      var _thit = this;\n\n      var map = new BMap.Map(\"allmap\");\n      var point = new BMap.Point(116.331398, 39.897445);\n      map.centerAndZoom(point, 12);\n      var geolocation = new BMap.Geolocation();\n      geolocation.getCurrentPosition(function (r) {\n        if (this.getStatus() == BMAP_STATUS_SUCCESS) {\n          var mk = new BMap.Marker(r.point);\n          map.addOverlay(mk);\n          map.panTo(r.point);\n          _thit.longitude = r.point.lng;\n          _thit.latitude = r.point.lat; // if (r.accuracy == null) {\n          //     WeixinJSBridge.call('closeWindow');\n          //     _thit.showToast('您没有开启权限！')\n          //     var opened = window.open('about:blank', '_self');\n          //     opened.opener = null;\n          //     opened.close();\n          //     return;\n          //     //用户决绝地理位置授权\n          // }\n          // debugger\n          // this.address = result.formattedAddress\n          // alert('您的位置：' + JSON.stringify(r.address) + r.point.lng+','+r.point.lat);\n        } else {\n          var opened = window.open('about:blank', '_self');\n          opened.opener = null;\n          opened.close();\n          WeixinJSBridge.call('closeWindow'); // alert('failed'+this.getStatus());\n        }\n      }, {\n        enableHighAccuracy: true\n      });\n    },\n    loginBack: function loginBack() {\n      this.src = require(\"../assets/login-submit.png\");\n      this.isLoginError = false;\n    },\n    loginError: function loginError() {\n      this.src = require(\"../assets/login-back.png\");\n      this.isLoginError = true;\n    },\n    doLogin: function doLogin() {\n      var _this = this;\n\n      this.$bmob.initialize('5341f8e254942033b3dae717daa7eed5', '4e0664824ca488cccad8fe1508a2baa0');\n\n      if (this.longitude) {\n        if (!this.isLoginError) {\n          this.$bmob.User.login(this.code, this.phone).then(function (res) {\n            _this.user = res;\n            console.log('user>>>>>' + _this.user);\n\n            _this.checkHasQuestions(res.objectId);\n          }).catch(function (err) {\n            _this.loginError();\n\n            console.log(err);\n          });\n        } else {\n          this.loginBack();\n        }\n      } else {\n        WeixinJSBridge.call('closeWindow');\n        this.showToast('您没有开启权限！');\n        var opened = window.open('about:blank', '_self');\n        opened.opener = null;\n        opened.close();\n      }\n    },\n    checkHasQuestions: function checkHasQuestions(objectId) {\n      var _this2 = this;\n\n      var pointer = this.$bmob.Pointer('_User');\n      var poiID = pointer.set(objectId);\n      var query = this.$bmob.Query(\"question\");\n      query.equalTo(\"user\", \"==\", poiID);\n      query.count().then(function (res) {\n        if (res === 0) {\n          _this2.loginSuccess();\n        } else {\n          _this2.showToast('你已经答过题了！');\n        }\n      });\n    },\n    loginSuccess: function loginSuccess() {\n      localStorage.setItem(\"userId\", this.user.objectId);\n      localStorage.setItem(\"longitude\", this.longitude);\n      localStorage.setItem(\"latitude\", this.latitude);\n      console.log('qqq>>>>>' + this.user.objectId); // this.$router.push({name: 'rule'});\n\n      this.$router.replace({\n        name: 'empty'\n      });\n    },\n    checkWx: function checkWx() {\n      var useragent = navigator.userAgent;\n\n      if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {\n        // 这里警告框会阻塞当前页面继续加载\n        alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！'); // 以下代码是用javascript强行关闭当前页面\n\n        var opened = window.open('about:blank', '_self');\n        opened.opener = null;\n        opened.close();\n      }\n    }\n  },\n  created: function created() {\n    this.checkWx();\n    this.getLocation();\n  }\n};",{"version":3,"sources":["Login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <div class=\"all-login\">\n        <div class=\"all-login-info\">\n            <img class=\"login-bg\" src=\"../assets/login-bg.png\"/>\n            <div class=\"login-info\" v-if=\"!isLoginError\">\n                <div class=\"login-name\">\n                    <img src=\"../assets/people.png\"/>\n                    <input type=\"text\" placeholder=\"门店编号\" v-model=\"code\"/>\n                </div>\n                <div class=\"login-name\">\n                    <img src=\"../assets/phone.png\"/>\n                    <input type=\"text\" placeholder=\"手机号\" v-model=\"phone\"/>\n                </div>\n            </div>\n\n            <div class=\"login-error\" v-if=\"isLoginError\">\n                <div class=\"error-title\">\n                    <img src=\"../assets/login-error.png\"/> 无法登陆\n                </div>\n                <div class=\"error-info\">1.您未入围</div>\n                <div class=\"error-info\">2.门店编号或手机号输入有误</div>\n            </div>\n\n            <img class=\"login-submit\" :src=src @click=\"doLogin\"/>\n        </div>\n\n        <div class=\"login-bottom\">请务必在您的门店内答题，我将全程对您实时定位</div>\n\n    </div>\n</template>\n\n<script>\n    export default {\n        name: \"Login\",\n        data() {\n            return {\n                isLoginError: false,\n                longitude: 0,\n                latitude: 0,\n                code: '',\n                phone: '',\n                user: {},\n                src: require('../assets/login-submit.png')\n            }\n        },\n        methods: {\n            showToast(msg, duration) {\n                duration = isNaN(duration) ? 3000 : duration;\n                var m = document.createElement('div');\n                m.innerHTML = msg;\n                m.style.cssText = \"width:60%; min-width:180px; background:#000; opacity:0.6; height:auto;min-height: 30px; color:#fff; line-height:30px; text-align:center; border-radius:4px; position:fixed; top:60%; left:20%; z-index:999999;\";\n                document.body.appendChild(m);\n                setTimeout(function () {\n                    var d = 0.5;\n                    m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';\n                    m.style.opacity = '0';\n                    setTimeout(function () {\n                        document.body.removeChild(m)\n                    }, d * 1000);\n                }, duration);\n            },\n            getLocation() {\n                let _thit = this\n                var map = new BMap.Map(\"allmap\");\n                var point = new BMap.Point(116.331398, 39.897445);\n                map.centerAndZoom(point, 12);\n\n                var geolocation = new BMap.Geolocation();\n                geolocation.getCurrentPosition(function (r) {\n                    if (this.getStatus() == BMAP_STATUS_SUCCESS) {\n                        var mk = new BMap.Marker(r.point);\n                        map.addOverlay(mk);\n                        map.panTo(r.point);\n                        _thit.longitude = r.point.lng\n                        _thit.latitude = r.point.lat\n                        // if (r.accuracy == null) {\n                        //     WeixinJSBridge.call('closeWindow');\n                        //     _thit.showToast('您没有开启权限！')\n                        //     var opened = window.open('about:blank', '_self');\n                        //     opened.opener = null;\n                        //     opened.close();\n                        //     return;\n                        //     //用户决绝地理位置授权\n                        // }\n                        // debugger\n                        // this.address = result.formattedAddress\n                        // alert('您的位置：' + JSON.stringify(r.address) + r.point.lng+','+r.point.lat);\n                    } else {\n                        var opened = window.open('about:blank', '_self');\n                        opened.opener = null;\n                        opened.close();\n                        WeixinJSBridge.call('closeWindow');\n                        // alert('failed'+this.getStatus());\n                    }\n                }, {enableHighAccuracy: true})\n            },\n            loginBack() {\n                this.src = require('../assets/login-submit.png')\n                this.isLoginError = false\n            },\n            loginError() {\n                this.src = require('../assets/login-back.png')\n                this.isLoginError = true\n            },\n            doLogin() {\n                this.$bmob.initialize('5341f8e254942033b3dae717daa7eed5', '4e0664824ca488cccad8fe1508a2baa0');\n                if (this.longitude) {\n                    if (!this.isLoginError) {\n                        this.$bmob.User.login(this.code, this.phone).then(res => {\n                            this.user = res\n                            console.log('user>>>>>' + this.user)\n                            this.checkHasQuestions(res.objectId)\n                        }).catch(err => {\n                            this.loginError()\n                            console.log(err)\n                        });\n                    } else {\n                        this.loginBack()\n                    }\n                } else {\n                    WeixinJSBridge.call('closeWindow');\n                    this.showToast('您没有开启权限！')\n                    var opened = window.open('about:blank', '_self');\n                    opened.opener = null;\n                    opened.close();\n                }\n\n\n            },\n            checkHasQuestions(objectId) {\n                const pointer = this.$bmob.Pointer('_User');\n                const poiID = pointer.set(objectId);\n                const query = this.$bmob.Query(\"question\");\n                query.equalTo(\"user\", \"==\", poiID);\n                query.count().then(res => {\n                    if (res === 0) {\n                        this.loginSuccess()\n                    } else {\n                        this.showToast('你已经答过题了！')\n                    }\n                });\n            },\n            loginSuccess() {\n                localStorage.setItem(\"userId\", this.user.objectId)\n                localStorage.setItem(\"longitude\", this.longitude)\n                localStorage.setItem(\"latitude\", this.latitude)\n                console.log('qqq>>>>>' + this.user.objectId)\n                // this.$router.push({name: 'rule'});\n                this.$router.replace({name: 'empty'});\n            },\n            checkWx() {\n                var useragent = navigator.userAgent;\n                if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {\n                    // 这里警告框会阻塞当前页面继续加载\n                    alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');\n                    // 以下代码是用javascript强行关闭当前页面\n                    var opened = window.open('about:blank', '_self');\n                    opened.opener = null;\n                    opened.close();\n                }\n            }\n        },\n        created() {\n            this.checkWx()\n            this.getLocation()\n        }\n    }\n</script>\n\n<style lang=\"stylus\" scoped>\n    .all-login\n        width 100%\n        height 100%\n        padding 0 48px\n        background: linear-gradient(to bottom, #ffffff, #e6ddf1, #e6ddf1, #e6ddf1, #3b6e9e);\n        display flex\n        flex-direction column\n        .all-login-info\n            flex 1\n            .login-submit\n                width 135px\n                height 135px\n                margin auto\n                margin-top -65px\n                text-align center\n            .login-bg\n                width 650px\n                margin-top 75px\n            .login-info\n                background #f5f3fb\n                border-radius 30px\n                padding 30px 30px\n                width 100%\n                height 460px\n                display flex\n                flex-direction column\n                .login-name\n                    width 100%\n                    height 100px\n                    background #fff\n                    border-radius 30px\n                    text-align left\n                    display flex\n                    margin-top 50px\n                    img\n                        text-align left\n                        margin-left 30px\n                        width 65px\n                        height 75px\n                        margin-top 12px\n                    input\n                        margin-left 100px\n                        width 350px\n                        outline none\n                        font-size 50px\n                        color #3b6e9e\n                        background white\n                        border none\n            .login-error\n                background #f5f3fb\n                border-radius 30px\n                padding 30px 30px\n                margin-top 60px\n                width 100%\n                height 360px\n                text-align left\n                .error-title\n                    font-size 70px\n                    display flex\n                    margin-left 80px\n                    margin-top 30px\n                    img\n                        width 100px\n                        height 100px\n                        margin-right 20px\n                .error-info\n                    margin-left 80px\n                    font-size 40px\n        .login-bottom\n            width 100%\n            font-size 20px\n            color white\n            padding-bottom 40px\n            text-align center\n</style>"],"sourceRoot":"src/views"}]}